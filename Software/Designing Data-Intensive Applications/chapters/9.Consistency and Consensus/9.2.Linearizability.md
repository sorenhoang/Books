# **Linearizability**

**Linearizability** (also known as **atomic consistency**, **strong consistency**, or **immediate consistency**) is a consistency model that makes a system appear as if there is only a **single copy of the data** and all operations on it are **atomic**. It is fundamentally a **recency guarantee**, ensuring that the value read is always the most up-to-date and does not come from a stale cache or replica.

---

### **What Makes a System Linearizable?**

The core requirement of linearizability is that once a client has successfully completed a write or observed a new value, **all subsequent reads** (by any client) must see that new value or a later one. 

*   **Atomic Take-Effect:** In a linearizable system, every operation must appear to take effect **atomically at some point** between its start and end time.
*   **Forward-Moving Time:** If we visualize the execution of operations, the points in time at which they take effect must always **move forward**, never backward.
*   **Preventing Flips:** Even if a read is concurrent with a write, the system must not allow a reader to see the new value and then subsequently see the old value again; once the "flip" to the new value occurs, it must be permanent for all observers.

---

### **Linearizability vs. Serializability**

It is critical to distinguish these two terms, as they are often confused:

*   **Serializability:** An **isolation property of transactions** that ensures the result of running multiple transactions (each potentially involving multiple objects) is the same as if they had run in some serial order.
*   **Linearizability:** A **recency guarantee on a single object** (register) that ensures a read always reflects the latest write.
*   **Strict Serializability:** A system that provides **both** guarantees simultaneously, also known as **strong one-copy serializability**.

---

### **Relying on Linearizability**

Linearizability is essential for the correct functioning of several distributed system patterns:

*   **Locking and Leader Election:** A system using single-leader replication must ensure only one node is the leader; this requires a **linearizable lock** that all nodes agree upon.
*   **Uniqueness Constraints:** Enforcing that a **username** or email address is unique requires all nodes to agree on a single up-to-date value to prevent concurrent registrations of the same name.
*   **Cross-Channel Timing Dependencies:** Without linearizability, a "side channel" (like a message queue or a human speaking) can reveal **causality violations**. For example, if a web server writes an image to storage and then sends a message to a resizer, a nonlinearizable storage system might show the resizer a stale or nonexistent image.

---

### **Implementing Linearizable Systems**

The ability to provide linearizability depends heavily on the **replication method** used:

*   **Single-Leader Replication:** Potentially linearizable if **reads are sent to the leader** or to synchronously updated followers.
*   **Consensus Algorithms:** Algorithms like **Zab (ZooKeeper)** and **Raft (etcd)** are designed to implement linearizable storage safely by preventing split-brain and stale replicas.
*   **Multi-Leader Replication:** **Not linearizable** because they process writes on multiple nodes and replicate them asynchronously, allowing for conflicting writes.
*   **Leaderless Replication:** Generally **not linearizable**. Even with "strict" quorums ($w + r > n$), variable network delays can lead to race conditions where a read follows a write but still returns the old value.

---

### **The Cost of Linearizability**

Linearizability comes with significant trade-offs in **performance** and **fault tolerance**:

*   **The CAP Theorem:** If a system requires linearizability and a **network partition** occurs, some replicas must stop processing requests (becoming **unavailable**) until the network is repaired. Systems that prioritize availability over linearizability can continue processing requests but will violate linearizability during the fault.
*   **Performance Hit:** Linearizability is **inherently slow** because its response time is proportional to the **uncertainty of network delays**. Many systems drop linearizability not for fault tolerance, but because weaker consistency models are significantly faster.

***

**Analogy:** Linearizability is like a **single physical whiteboard** in a room. If one person writes a message on the board and walks away, anyone else who enters the room at a later time is guaranteed to see that exact message. However, **eventual consistency** is more like a **game of telephone**: one person whispers a message to another, and it slowly ripples through the group. While everyone will eventually hear the message, different people will believe different things are "true" at any given moment until the message has reached everyone.